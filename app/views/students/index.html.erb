
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h3 mb-0 text-gray-800">Students Dashboard</h1>
          <p class="text-muted small mb-0">Manage all student records</p>
        </div>
        <%= link_to new_student_path, class: "btn btn-primary shadow-sm" do %>
          <i class="bi bi-plus-lg me-1"></i> Add New Student
        <% end %>
      </div>
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body p-4">
          <%= search_form_for @q, url: students_path, method: :get, class: "search-form", data: { controller: "autosubmit", turbo_frame: "students_results" } do |f| %>
            <div class="row g-3 align-items-end">
               <div class="col-md-4 col-lg-3">
                  <%= f.label :name_cont, "Student Name", class: "form-label fw-bold small text-uppercase text-muted" %>
                  <div class="input-group">
                    <span class="input-group-text bg-light border-end-0"><i class="bi bi-search text-muted"></i></span>
                    <%= f.text_field :name_cont, 
                        class: "form-control bg-light border-start-0 ps-0", 
                        placeholder: "Search here...", 
                        data: { action: "input->autosubmit#submit" } %>
                  </div>
               </div>
               
               <div class="col-md-3 col-lg-3">
                  <%= f.label :class_name_eq, "Class", class: "form-label fw-bold small text-uppercase text-muted" %>
                  <div class="dropdown" data-controller="hover-filter">
                      <%= f.hidden_field :class_name_eq, data: { hover_filter_target: "input" } %>
                      <button class="btn btn-light border w-100 text-start d-flex justify-content-between align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <span data-hover-filter-target="label">All Classes</span>
                        <i class="bi bi-chevron-down small text-muted"></i>
                      </button>
                      <ul class="dropdown-menu w-100 shadow-sm border-0">
                        <li><a class="dropdown-item" href="#" data-value="" data-action="mouseenter->hover-filter#preview">All Classes</a></li>
                        <% Student.distinct.order(:class_name).pluck(:class_name).each do |c| %>
                           <li><a class="dropdown-item" href="#" data-value="<%= c %>" data-action="mouseenter->hover-filter#preview"><%= c %></a></li>
                        <% end %>
                      </ul>
                  </div>
               </div>

               <div class="col-md-3 col-lg-3">
                  <%= f.label :status_eq, "Status", class: "form-label fw-bold small text-uppercase text-muted" %>
                  <div class="dropdown" data-controller="hover-filter">
                      <%= f.hidden_field :status_eq, data: { hover_filter_target: "input" } %>
                      <button class="btn btn-light border w-100 text-start d-flex justify-content-between align-items-center" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <span data-hover-filter-target="label">All Status</span>
                        <i class="bi bi-chevron-down small text-muted"></i>
                      </button>
                      <ul class="dropdown-menu w-100 shadow-sm border-0">
                        <li><a class="dropdown-item" href="#" data-value="" data-action="mouseenter->hover-filter#preview">All Status</a></li>
                        <li><a class="dropdown-item text-success" href="#" data-value="active" data-action="mouseenter->hover-filter#preview"><i class="bi bi-circle-fill me-2" style="font-size: 6px;"></i>Active</a></li>
                         <li><a class="dropdown-item text-secondary" href="#" data-value="inactive" data-action="mouseenter->hover-filter#preview"><i class="bi bi-circle-fill me-2" style="font-size: 6px;"></i>Inactive</a></li>
                          <li><a class="dropdown-item text-info" href="#" data-value="graduated" data-action="mouseenter->hover-filter#preview"><i class="bi bi-circle-fill me-2" style="font-size: 6px;"></i>Graduated</a></li>
                      </ul>
                  </div>
               </div>

               <div class="col-md-2 col-lg-3">
                  <div class="d-flex gap-2">
                     <%= link_to students_path, class: "btn btn-light border w-100 fw-semibold text-secondary", title: "Refresh / Clear", data: { bs_toggle: "tooltip" } do %>
                        <i class="bi bi-arrow-clockwise me-2"></i>Reset
                     <% end %>
                  </div>
               </div>
            </div>
          <% end %>
        </div>
      </div>
      
      <div class="card shadow-sm border-0">
        <div class="card-body p-0">
          <div class="table-responsive">
            <%= turbo_frame_tag "students_results" do %>
            <table class="table table-hover align-middle mb-2">
              <thead class="bg-light">
                <tr>
                  <th class="px-4 py-3 border-0 text-secondary small text-uppercase fw-bold">Name</th>
                  <th class="py-3 border-0 text-secondary small text-uppercase fw-bold">Roll No.</th>
                  <th class="py-3 border-0 text-secondary small text-uppercase fw-bold">Class</th>
                  <th class="py-3 border-0 text-secondary small text-uppercase fw-bold">Email</th>
                  <th class="py-3 border-0 text-secondary small text-uppercase fw-bold">Status</th>
                  <th class="py-3 border-0 text-secondary small text-uppercase fw-bold">Enrollment Date</th>
                  <th class="px-4 py-3 border-0 text-center text-secondary small text-uppercase fw-bold">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% @students.each do |student| %>
                  <tr>
                    <td class="px-4 pt-3 pb-3">
                      <div class="fw-bold text-dark"><%= student.name %></div>
                    </td>
                    <td>
                      <span class="badge bg-light text-dark border">
                        <%= student.roll_number %>
                      </span>
                    </td>
                    <td>
                      <span class="badge bg-info-subtle text-info">
                        <%= student.class_name %>
                      </span>
                    </td>
                    <td>
                      <small class="text-muted"><%= student.email %></small>
                    </td>
                    <td>
                      <span class="badge rounded-pill <%= student.active? ? 'bg-success-subtle text-success' : student.graduated? ? 'bg-info-subtle text-info' : 'bg-secondary-subtle text-secondary' %>">
                        <i class="bi bi-circle-fill me-1" style="font-size: 6px;"></i>
                        <%= student.status %>
                      </span>
                    </td>
                    <td>
                      <small class="text-muted">
                        <%= student.enrollment_date.respond_to?(:strftime) ? student.enrollment_date.strftime('%d %b %Y') : student.enrollment_date %>
                      </small>
                    </td>
                    <td class="px-4 text-end">
                      <div class="d-flex justify-content-end gap-2">
                          <%= link_to "View", student, class: "btn btn-sm btn-light border fw-semibold", data: { turbo_frame: "_top" } %>
                          <%= link_to "Edit", edit_student_path(student), class: "btn btn-sm btn-light border text-primary fw-semibold", data: { turbo_frame: "_top" } %>

                        <% if @current_user.admin? %>
                          <%= button_to "Delete", student, method: :delete, 
                              form: { data: { turbo_confirm: "Are you sure you want to delete #{student.name}?" } },
                              class: "btn btn-sm btn-light border text-danger fw-semibold" %>
                       <% end %>
                      </div>

                    </td>
                  </tr>
                <% end %>
                <% if @students.empty? %>
                  <tr>
                    <td colspan="7" class="text-center py-5">
                      <div class="py-4">
                        <div class="mb-3">
                           <i class="bi bi-search text-muted display-4 opacity-25"></i>
                        </div>
                        <h5 class="text-muted fw-bold">No students found</h5>
                        <p class="text-muted small mb-4">Try adjusting your search filters to find what you're looking for.</p>
                        <%= link_to 'Add New Student', new_student_path, class: "btn btn-primary px-4 fw-semibold", data: { turbo_frame: "_top" } %>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            
           <% if @students.respond_to?(:total_pages) && @students.total_pages > 1 %>
             <div class="mt-3 mb-4 d-flex justify-content-center custom-pagination">
               <%= paginate @students, window: 1 %>
             </div>
           <% end %>
           
           <% end %> <!-- End Turbo Frame -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

